# Configuração Apache para Proxy WebSocket
# /etc/apache2/sites-available/chat-websocket.conf

<VirtualHost *:80>
    ServerName chat.seudominio.com
    DocumentRoot /var/www/html/chat
    
    # Serve arquivos estáticos normalmente
    <Directory /var/www/html/chat>
        AllowOverride All
        Require all granted
    </Directory>
    
    # Proxy para servidor WebSocket (Node.js ou Python)
    ProxyPreserveHost On
    ProxyPassMatch ^/ws/(.*)$ ws://localhost:3000/ws/$1
    ProxyPassReverse /ws/ ws://localhost:3000/ws/
    
    # Proxy para API WebSocket HTTP
    ProxyPass /api/ http://localhost:3000/api/
    ProxyPassReverse /api/ http://localhost:3000/api/
    
    # Headers para WebSocket
    <Location "/ws/">
        ProxyPass ws://localhost:3000/ws/
        ProxyPassReverse ws://localhost:3000/ws/
        
        # Headers necessários para WebSocket
        RewriteEngine On
        RewriteCond %{HTTP:Upgrade} websocket [NC]
        RewriteCond %{HTTP:Connection} upgrade [NC]
        RewriteRule ^/?(.*) "ws://localhost:3000/ws/$1" [P,L]
    </Location>
    
    ErrorLog ${APACHE_LOG_DIR}/chat_ws_error.log
    CustomLog ${APACHE_LOG_DIR}/chat_ws_access.log combined
</VirtualHost>

# Módulos necessários:
# sudo a2enmod proxy
# sudo a2enmod proxy_http
# sudo a2enmod proxy_wstunnel
# sudo a2enmod rewrite
